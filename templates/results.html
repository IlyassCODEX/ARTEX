{% extends "base.html" %}

{% block title %}Scan Results - {{ results.domain }} | ARTEX{% endblock %}

{% block extra_css %}
<style>
    /* Custom table styling */
    .results-table {
        border-collapse: separate;
        border-spacing: 0;
        width: 100%;
    }
    
    .results-table th {
        background-color: var(--primary-light);
        color: var(--dark-color);
        font-weight: 600;
        padding: 1rem;
        border-bottom: 2px solid var(--primary-color);
    }
    
    .results-table td {
        padding: 1rem;
        border-bottom: 1px solid #e2e8f0;
        vertical-align: top;
    }
    
    .results-table tr:last-child td {
        border-bottom: none;
    }
    
    .results-table tr:hover td {
        background-color: rgba(67, 97, 238, 0.05);
    }
    
    /* Risk level badges */
    .risk-badge {
        padding: 0.35rem 0.75rem;
        border-radius: 20px;
        font-weight: 500;
    }
    
    .risk-critical {
        background-color: rgba(239, 68, 68, 0.1);
        color: var(--danger-color);
    }
    
    .risk-high {
        background-color: rgba(245, 158, 11, 0.1);
        color: var(--warning-color);
    }
    
    .risk-medium {
        background-color: rgba(59, 130, 246, 0.1);
        color: var(--info-color);
    }
    
    .risk-low {
        background-color: rgba(16, 185, 129, 0.1);
        color: var(--success-color);
    }
    
    /* Tab styling */
    .nav-tabs .nav-link {
        border: none;
        color: #64748b;
        font-weight: 500;
        padding: 0.75rem 1.25rem;
        margin-right: 0.5rem;
        border-radius: var(--border-radius) var(--border-radius) 0 0;
    }
    
    .nav-tabs .nav-link.active {
        color: var(--primary-color);
        background-color: white;
        border-bottom: 2px solid var(--primary-color);
    }
    
    .nav-tabs .nav-link:hover:not(.active) {
        color: var(--dark-color);
        background-color: #f1f5f9;
    }
    
    .tab-content {
        background-color: white;
        border-radius: 0 var(--border-radius) var(--border-radius) var(--border-radius);
        padding: 1.5rem;
        box-shadow: var(--box-shadow);
    }
    
    /* Accordion styling */
    .accordion-button {
        font-weight: 500;
        padding: 1rem 1.5rem;
    }
    
    .accordion-button:not(.collapsed) {
        background-color: var(--primary-light);
        color: var(--primary-color);
    }
    
    .accordion-body {
        padding: 1.5rem;
    }
    
    /* Status indicators */
    .status-indicator {
        display: inline-flex;
        align-items: center;
    }
    
    .status-indicator::before {
        content: "";
        display: inline-block;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        margin-right: 6px;
    }
    
    .status-active::before {
        background-color: var(--success-color);
    }
    
    .status-inactive::before {
        background-color: #94a3b8;
    }
    
    .status-warning::before {
        background-color: var(--warning-color);
    }
    
    /* Card header styling */
    .card-header-modern {
        background-color: white;
        border-bottom: 1px solid #e2e8f0;
        padding: 1.25rem 1.5rem;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        .results-table th, 
        .results-table td {
            padding: 0.75rem;
        }
        
        .nav-tabs .nav-link {
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
        }
    }
    /* Add to the extra_css block in results.html */
.ssl-grade-a {
    background-color: rgba(16, 185, 129, 0.1);
    color: var(--success-color);
}
.ssl-grade-b {
    background-color: rgba(59, 130, 246, 0.1);
    color: var(--info-color);
}
.ssl-grade-c {
    background-color: rgba(245, 158, 11, 0.1);
    color: var(--warning-color);
}
.ssl-grade-d, .ssl-grade-f {
    background-color: rgba(239, 68, 68, 0.1);
    color: var(--danger-color);
}

.cipher-strength {
    font-weight: 500;
}
.cipher-strength-strong {
    color: var(--success-color);
}
.cipher-strength-moderate {
    color: var(--info-color);
}
.cipher-strength-weak {
    color: var(--warning-color);
}
.cipher-strength-very-weak {
    color: var(--danger-color);
}
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold mb-1">
                <i class="bi bi-shield-lock me-2"></i>Scan Results: {{ results.domain }}
            </h2>
            <div class="text-muted">
                Scan ID: {{ scan_id }} | {{ results.timestamp }} | 
                Duration: {{ results.duration if results.duration else 'N/A' }}
            </div>
        </div>
        <div class="d-flex gap-2">
            <a href="/export/{{ scan_id }}?format=pdf" class="btn btn-sm btn-outline-primary">
                <i class="bi bi-file-earmark-pdf me-1"></i> PDF
            </a>
            <a href="/export/{{ scan_id }}?format=json" class="btn btn-sm btn-outline-primary">
                <i class="bi bi-filetype-json me-1"></i> JSON
            </a>
            <a href="/" class="btn btn-sm btn-outline-primary">
                <i class="bi bi-plus-circle me-1"></i> New Scan
            </a>
        </div>
    </div>
    
    <div class="alert alert-modern alert-info mb-4">
        <div class="d-flex align-items-center">
            <i class="bi bi-info-circle-fill me-3 fs-4"></i>
            <div>
                <strong>Scan options:</strong>
                {% if results.options.subdomains %}<span class="badge bg-primary me-2">Subdomains</span>{% endif %}
                {% if results.options.ports %}<span class="badge bg-primary me-2">Ports</span>{% endif %}
                {% if results.options.dns_records %}<span class="badge bg-primary me-2">DNS</span>{% endif %}
                {% if results.options.tech %}<span class="badge bg-primary me-2">Technologies</span>{% endif %}
                {% if results.options.email %}<span class="badge bg-primary me-2">Emails</span>{% endif %}
                <span class="badge bg-success me-2">Security Analysis</span>
                <span class="badge bg-success">AI Analysis</span>
            </div>
        </div>
    </div>
    
    {% if results.ai_analysis %}
    <div class="card card-modern mb-4">
        <div class="card-header-modern">
            <h4 class="mb-0">
                <i class="bi bi-robot me-2"></i>AI-Powered Security Insights
                {% if results.ai_analysis.owner_analysis.ai_model %}
                <span class="badge bg-info ms-2">{{ results.ai_analysis.owner_analysis.ai_model }}</span>
                {% endif %}
            </h4>
        </div>
        <div class="card-body">
            <!-- Owner Perspective -->
            <div class="mb-5">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4><i class="bi bi-shield-check me-2"></i>Website Owner Perspective</h4>
                    <span class="badge bg-primary">Protection Focused</span>
                </div>
                
                <div class="mb-4">
                    <h5 class="mb-3">Security Summary</h5>
                    <div class="p-3 bg-light rounded">
                        <p class="mb-0">{{ results.ai_analysis.owner_analysis.summary }}</p>
                    </div>
                </div>
                
                <div class="row g-4 mb-4">
                    <div class="col-md-6">
                        <div class="card h-100 border-0 shadow-sm">
                            <div class="card-header-modern">
                                <h6 class="mb-0"><i class="bi bi-exclamation-triangle me-2"></i>Critical Findings</h6>
                            </div>
                            <div class="card-body">
                                <ul class="list-group list-group-flush">
                                    {% for finding in results.ai_analysis.owner_analysis.key_findings %}
                                    <li class="list-group-item border-0 px-0">{{ finding }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card h-100 border-0 shadow-sm">
                            <div class="card-header-modern">
                                <h6 class="mb-0"><i class="bi bi-lightning-charge me-2"></i>Immediate Actions</h6>
                            </div>
                            <div class="card-body">
                                <ul class="list-group list-group-flush">
                                    {% for action in results.ai_analysis.owner_analysis.immediate_actions %}
                                    <li class="list-group-item border-0 px-0">{{ action }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card border-0 shadow-sm">
                    <div class="card-header-modern">
                        <h6 class="mb-0"><i class="bi bi-check-circle me-2"></i>Protection Recommendations</h6>
                    </div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            {% for recommendation in results.ai_analysis.owner_analysis.protection_recommendations %}
                            <li class="list-group-item border-0 px-0">{{ recommendation }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Hunter Perspective -->
            <div class="mt-5 pt-4 border-top">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4><i class="bi bi-bug me-2"></i>Bug Bounty Hunter Perspective</h4>
                    <span class="badge bg-danger">Attack Focused</span>
                </div>
                
                <div class="mb-4">
                    <h5 class="mb-3">Hunting Summary</h5>
                    <div class="p-3 bg-light rounded">
                        <p class="mb-0">{{ results.ai_analysis.hunter_analysis.summary }}</p>
                    </div>
                </div>
                
                <div class="row g-4 mb-4">
                    <div class="col-md-4">
                        <div class="card h-100 border-0 shadow-sm">
                            <div class="card-header-modern">
                                <h6 class="mb-0"><i class="bi bi-bullseye me-2"></i>Promising Targets</h6>
                            </div>
                            <div class="card-body">
                                <ul class="list-group list-group-flush">
                                    {% for target in results.ai_analysis.hunter_analysis.promising_targets %}
                                    <li class="list-group-item border-0 px-0">
                                        <strong>{{ target.target }}</strong>
                                        <div class="text-muted small mt-1">{{ target.reason }}</div>
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card h-100 border-0 shadow-sm">
                            <div class="card-header-modern">
                                <h6 class="mb-0"><i class="bi bi-activity me-2"></i>Attack Vectors</h6>
                            </div>
                            <div class="card-body">
                                <ul class="list-group list-group-flush">
                                    {% for vector in results.ai_analysis.hunter_analysis.attack_vectors %}
                                    <li class="list-group-item border-0 px-0">
                                        <strong>{{ vector.type }}</strong>
                                        <div class="text-muted small mt-1">{{ vector.description }}</div>
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card h-100 border-0 shadow-sm">
                            <div class="card-header-modern">
                                <h6 class="mb-0"><i class="bi bi-search me-2"></i>Research Areas</h6>
                            </div>
                            <div class="card-body">
                                <ul class="list-group list-group-flush">
                                    {% for area in results.ai_analysis.hunter_analysis.research_areas %}
                                    <li class="list-group-item border-0 px-0">
                                        <strong>{{ area.technology }}</strong>
                                        <div class="text-muted small mt-1">{{ area.note }}</div>
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card border-0 shadow-sm">
                    <div class="card-header-modern">
                        <h6 class="mb-0"><i class="bi bi-gem me-2"></i>High Value Findings</h6>
                    </div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            {% for finding in results.ai_analysis.hunter_analysis.high_value_findings %}
                            <li class="list-group-item border-0 px-0">{{ finding }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    
    {% if results.security_analysis %}
    <div class="row g-4 mb-4">
        <div class="col-md-4">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-header-modern">
                    <h5 class="mb-0"><i class="bi bi-clipboard-data me-2"></i>Summary</h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item border-0 px-0 d-flex justify-content-between align-items-center">
                            Subdomains
                            <span class="badge bg-primary rounded-pill">{{ results.security_analysis.summary.total_subdomains }}</span>
                        </li>
                        <li class="list-group-item border-0 px-0 d-flex justify-content-between align-items-center">
                            Active
                            <span class="badge bg-primary rounded-pill">{{ results.security_analysis.summary.active_subdomains }}</span>
                        </li>
                        <li class="list-group-item border-0 px-0 d-flex justify-content-between align-items-center">
                            Technologies
                            <span class="badge bg-info rounded-pill">{{ results.tech_detection|length }}</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-header-modern">
                    <h5 class="mb-0"><i class="bi bi-shield-exclamation me-2"></i>Risk Assessment</h5>
                </div>
                <div class="card-body text-center">
                    <div class="mb-3">
                        {% set risk_level = results.security_analysis.risk_assessment.level|lower %}
                        <span class="badge rounded-pill py-2 px-3 fs-5 
                            {% if risk_level == 'high' %}bg-danger
                            {% elif risk_level == 'medium' %}bg-warning text-dark
                            {% else %}bg-success{% endif %}">
                            {{ results.security_analysis.risk_assessment.level }} ({{ results.security_analysis.risk_assessment.score }}/100)
                        </span>
                    </div>
                    <ul class="list-group list-group-flush mt-3">
                        {% for factor in results.security_analysis.risk_assessment.factors[:3] %}
                        <li class="list-group-item border-0 px-0">{{ factor }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-header-modern">
                    <h5 class="mb-0"><i class="bi bi-lightbulb me-2"></i>Top Insights</h5>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-flush">
                        {% for insight in results.security_analysis.insights[:3] %}
                        <div class="list-group-item border-0 px-0">
                            <i class="bi bi-chevron-right text-primary me-2"></i> {{ insight }}
                        </div>
                        {% endfor %}
                        {% if results.tech_detection %}
                        <div class="list-group-item border-0 px-0">
                            <i class="bi bi-chevron-right text-primary me-2"></i> 
                            {{ results.tech_detection|length }} technology profiles detected
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="card card-modern border-0 mb-4">
        <div class="card-body p-0">
            <ul class="nav nav-tabs" id="resultsTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="subdomains-tab" data-bs-toggle="tab" data-bs-target="#subdomains" type="button" role="tab">
                        <i class="bi bi-globe me-1"></i>Subdomains ({{ results.subdomains|length }})
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="realip-tab" data-bs-toggle="tab" data-bs-target="#realip" type="button" role="tab">
                        <i class="bi bi-ip me-1"></i>Real IP
                        {% if results.real_ip and results.real_ip.origin_ips %}
                        <span class="badge bg-info ms-1">{{ results.real_ip.origin_ips|length }}</span>
                        {% endif %}
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="ssl-tab" data-bs-toggle="tab" data-bs-target="#ssl" type="button" role="tab">
                        <i class="bi bi-lock me-1"></i>SSL
                    </button>
                </li>
                {% if results.port_scan %}
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="ports-tab" data-bs-toggle="tab" data-bs-target="#ports" type="button" role="tab">
                        <i class="bi bi-plug me-1"></i>Ports ({{ results.port_scan|length }} hosts)
                    </button>
                </li>
                {% endif %}
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="dns-tab" data-bs-toggle="tab" data-bs-target="#dns" type="button" role="tab">
                        <i class="bi bi-server me-1"></i>DNS Records
                        {% if results.dns_records %}
                            <span class="badge bg-info ms-1">{{ results.dns_records|length }}</span>
                        {% endif %}
                    </button>
                </li>
                {% if results.tech_detection %}
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="tech-tab" data-bs-toggle="tab" data-bs-target="#tech" type="button" role="tab">
                        <i class="bi bi-stack me-1"></i>Technologies
                        <span class="badge bg-info ms-1">{{ results.tech_detection|length }}</span>
                    </button>
                </li>
                {% endif %}
                {% if results.security_analysis %}
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="targets-tab" data-bs-toggle="tab" data-bs-target="#targets" type="button" role="tab">
                        <i class="bi bi-bullseye me-1"></i>Targets
                    </button>
                </li>
                {% endif %}
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button" role="tab">
                        <i class="bi bi-people me-1"></i>Users & Emails
                        {% if results.email_enumeration and (results.email_enumeration.found_emails or results.email_enumeration.login_pages) %}
                        <span class="badge bg-danger ms-1">
                            {{ results.email_enumeration.found_emails|length + results.email_enumeration.login_pages|length }}
                        </span>
                        {% endif %}
                    </button>
                </li>
            </ul>
            
            <div class="tab-content" id="resultsTabsContent">
                <!-- Subdomains Tab -->
                <div class="tab-pane fade show active" id="subdomains" role="tabpanel">
                    <div class="table-responsive">
                        <table class="table results-table" id="subdomainsTable">
                            <thead>
                                <tr>
                                    <th>Subdomain</th>
                                    <th>IP</th>
                                    <th>HTTP</th>
                                    <th>HTTPS</th>
                                    <th>Title</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for subdomain in results.subdomains %}
                                <tr>
                                    <td>
                                        {% if subdomain.http_status or subdomain.https_status %}
                                            <a href="{% if subdomain.https_status %}https://{% else %}http://{% endif %}{{ subdomain.subdomain }}" target="_blank" class="text-primary">
                                                {{ subdomain.subdomain }}
                                            </a>
                                        {% else %}
                                            {{ subdomain.subdomain }}
                                        {% endif %}
                                    </td>
                                    <td>{{ subdomain.ip }}</td>
                                    <td>
                                        {% if subdomain.http_status %}
                                        <span class="badge bg-{% if subdomain.http_status|string|slice(0,1) == '2' %}success{% elif subdomain.http_status|string|slice(0,1) == '3' %}info{% elif subdomain.http_status|string|slice(0,1) == '4' %}warning{% elif subdomain.http_status|string|slice(0,1) == '5' %}danger{% else %}secondary{% endif %}">
                                            {{ subdomain.http_status }}
                                        </span>
                                        {% else %}-{% endif %}
                                    </td>
                                    <td>
                                        {% if subdomain.https_status %}
                                        <span class="badge bg-{% if subdomain.https_status|string|slice(0,1) == '2' %}success{% elif subdomain.https_status|string|slice(0,1) == '3' %}info{% elif subdomain.https_status|string|slice(0,1) == '4' %}warning{% elif subdomain.https_status|string|slice(0,1) == '5' %}danger{% else %}secondary{% endif %}">
                                            {{ subdomain.https_status }}
                                        </span>
                                        {% else %}-{% endif %}
                                    </td>
                                    <td>{{ subdomain.title|default('')|truncate(30) }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Real IP Tab -->
                <div class="tab-pane fade" id="realip" role="tabpanel">
                    {% if results.real_ip and results.real_ip.origin_ips %}
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h4><i class="bi bi-server me-2"></i>Origin IP Detection</h4>
                            <span class="badge bg-primary">
                                {{ results.real_ip.origin_ips|length }} IPs found
                            </span>
                        </div>

                        <div class="table-responsive">
                            <table class="table results-table">
                                <thead>
                                    <tr>
                                        <th>IP Address</th>
                                        <th>Score</th>
                                        <th>Status</th>
                                        <th>Detection Methods</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for ip_data in results.real_ip.origin_ips|sort(attribute='score', reverse=True) %}
                                    <tr>
                                        <td><code>{{ ip_data.ip }}</code></td>
                                        <td>
                                            <span class="badge bg-{% if ip_data.score >= 15 %}success{% elif ip_data.score >= 10 %}warning{% else %}info{% endif %}">
                                                {{ ip_data.score }}
                                            </span>
                                        </td>
                                        <td>
                                            {% if ip_data.responds %}
                                            <span class="badge bg-success">✓ RESPONDS</span>
                                            {% else %}
                                            <span class="badge bg-secondary">✗ No response</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% for method in ip_data.methods %}
                                            <span class="badge bg-secondary me-1 mb-1">{{ method|replace('_',' ')|title }}</span>
                                            {% endfor %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>

                        <!-- Techniques Used -->
                        <div class="mb-4">
                            <h5><i class="bi bi-fingerprint me-2"></i>Detection Methods</h5>
                            <div class="d-flex flex-wrap gap-2">
                                {% for method in results.real_ip.techniques_used %}
                                <span class="badge bg-info">{{ method|replace('_',' ')|title }}</span>
                                {% endfor %}
                            </div>
                        </div>
                    {% else %}
                        <div class="alert alert-info alert-modern">
                            <i class="bi bi-info-circle me-2"></i> 
                            {% if not results.real_ip %}
                            Real IP detection was not performed for this scan
                            {% else %}
                            No origin IPs were found behind CDN/proxy
                            {% endif %}
                        </div>
                    {% endif %}
                </div>
                
<!-- SSL Tab -->
<div class="tab-pane fade" id="ssl" role="tabpanel">
    {% if results.ssl_scan %}
        <div class="accordion" id="sslAccordion">
            {% for host, ssl_data in results.ssl_scan.items() %}
            <div class="accordion-item border-0 mb-3 shadow-sm">
                <h2 class="accordion-header" id="sslHeading{{ loop.index }}">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                        data-bs-target="#sslCollapse{{ loop.index }}" aria-expanded="false">
                        <i class="bi bi-lock me-2"></i>
                        {{ host }}
                        {% if ssl_data.error %}
                            <span class="badge bg-danger ms-2">Error</span>
                        {% else %}
                            <span class="badge bg-{% if ssl_data.validation.trusted %}success{% else %}warning{% endif %} ms-2">
                                {% if ssl_data.validation.trusted %}Trusted{% else %}Untrusted{% endif %}
                            </span>
                            {% if ssl_data.validation.expired %}
                                <span class="badge bg-danger ms-2">Expired</span>
                            {% endif %}
                        {% endif %}
                    </button>
                </h2>
                <div id="sslCollapse{{ loop.index }}" class="accordion-collapse collapse" 
                    aria-labelledby="sslHeading{{ loop.index }}" data-bs-parent="#sslAccordion">
                    <div class="accordion-body">
                        {% if ssl_data.error %}
                            <div class="alert alert-danger alert-modern">
                                <i class="bi bi-x-circle me-2"></i> {{ ssl_data.error }}
                            </div>
                        {% else %}
                            <!-- Certificate Information -->
                            <h5 class="mb-3"><i class="bi bi-file-earmark-certificate me-2"></i>Certificate Information</h5>
                            <div class="table-responsive mb-4">
                                <table class="table results-table">
                                    <tr>
                                        <th>Subject</th>
                                        <td>
                                            {% if ssl_data.certificates and ssl_data.certificates[0].subject %}
                                                {% for key, value in ssl_data.certificates[0].subject.items() %}
                                                    {{ key }}: {{ value }}<br>
                                                {% endfor %}
                                            {% else %}
                                                No subject information
                                            {% endif %}
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Issuer</th>
                                        <td>
                                            {% if ssl_data.certificates and ssl_data.certificates[0].issuer %}
                                                {% for key, value in ssl_data.certificates[0].issuer.items() %}
                                                    {{ key }}: {{ value }}<br>
                                                {% endfor %}
                                            {% else %}
                                                No issuer information
                                            {% endif %}
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Validity</th>
                                        <td>
                                            {{ ssl_data.certificates[0].not_before|datetimeformat }} to 
                                            {{ ssl_data.certificates[0].not_after|datetimeformat }}
                                            {% if ssl_data.validation.expired %}
                                                <span class="badge bg-danger ms-2">EXPIRED</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Public Key</th>
                                        <td>
                                            {{ ssl_data.certificates[0].public_key.type }} 
                                            ({{ ssl_data.certificates[0].public_key.size }} bits)
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Signature Algorithm</th>
                                        <td>
                                            {{ ssl_data.certificates[0].signature_algorithm }}
                                            {% if ssl_data.validation.has_sha1_signature %}
                                                <span class="badge bg-danger ms-2">INSECURE</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Fingerprints</th>
                                        <td>
                                            SHA-1: <code>{{ ssl_data.certificates[0].fingerprint_sha1 }}</code><br>
                                            SHA-256: <code>{{ ssl_data.certificates[0].fingerprint_sha256 }}</code>
                                        </td>
                                    </tr>
                                </table>
                            </div>

                            <!-- Protocol Support -->
                            <h5 class="mb-3"><i class="bi bi-shield-lock me-2"></i>Protocol Support</h5>
                            <div class="table-responsive mb-4">
                                <table class="table results-table">
                                    <thead>
                                        <tr>
                                            <th>Protocol</th>
                                            <th>Supported</th>
                                            <th>Security</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for proto, supported in ssl_data.protocols.items() %}
                                        <tr>
                                            <td>{{ proto }}</td>
                                            <td>
                                                {% if supported %}
                                                    <span class="badge bg-{% if proto in ['TLSv1.2', 'TLSv1.3'] %}success{% else %}danger{% endif %}">
                                                        YES
                                                    </span>
                                                {% else %}
                                                    <span class="badge bg-secondary">NO</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {% if proto in ['TLSv1.2', 'TLSv1.3'] %}
                                                    Secure
                                                {% elif proto in ['TLSv1.0', 'TLSv1.1'] %}
                                                    Weak
                                                {% elif proto in ['SSLv2', 'SSLv3'] %}
                                                    Insecure
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>

                            <!-- Cipher Suites -->
                            <h5 class="mb-3"><i class="bi bi-key me-2"></i>Cipher Suites</h5>
                            <div class="alert alert-{% if ssl_data.ciphers.grade == 'A' %}success{% elif ssl_data.ciphers.grade == 'B' %}info{% elif ssl_data.ciphers.grade == 'C' %}warning{% else %}danger{% endif %} alert-modern mb-3">
                                <i class="bi bi-{% if ssl_data.ciphers.grade == 'A' %}shield-check{% elif ssl_data.ciphers.grade == 'B' %}shield{% else %}shield-exclamation{% endif %} me-2"></i>
                                Cipher Suite Grade: <strong>{{ ssl_data.ciphers.grade }}</strong>
                                {% if ssl_data.ciphers.preferred %}
                                    | Preferred Cipher: <strong>{{ ssl_data.ciphers.preferred.name }}</strong> ({{ ssl_data.ciphers.preferred.strength }})
                                {% endif %}
                            </div>
                            
                            <div class="row g-3 mb-4">
                                <div class="col-md-6">
                                    <div class="card border-0 shadow-sm h-100">
                                        <div class="card-header-modern">
                                            <h6 class="mb-0"><i class="bi bi-check-circle me-2"></i>Recommended Ciphers</h6>
                                        </div>
                                        <div class="card-body">
                                            {% if ssl_data.ciphers.recommended %}
                                                <ul class="list-group list-group-flush">
                                                    {% for cipher in ssl_data.ciphers.recommended %}
                                                    <li class="list-group-item border-0 px-0"><code>{{ cipher }}</code></li>
                                                    {% endfor %}
                                                </ul>
                                            {% else %}
                                                <div class="alert alert-info alert-modern mb-0">
                                                    No recommended ciphers found
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card border-0 shadow-sm h-100">
                                        <div class="card-header-modern">
                                            <h6 class="mb-0"><i class="bi bi-exclamation-triangle me-2"></i>Weak Ciphers</h6>
                                        </div>
                                        <div class="card-body">
                                            {% if ssl_data.ciphers.weak %}
                                                <ul class="list-group list-group-flush">
                                                    {% for cipher in ssl_data.ciphers.weak %}
                                                    <li class="list-group-item border-0 px-0"><code>{{ cipher }}</code></li>
                                                    {% endfor %}
                                                </ul>
                                            {% else %}
                                                <div class="alert alert-success alert-modern mb-0">
                                                    No weak ciphers detected
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Security Features -->
                            <h5 class="mb-3"><i class="bi bi-shield-check me-2"></i>Security Features</h5>
                            <div class="row g-3 mb-4">
                                <div class="col-md-4">
                                    <div class="card border-0 shadow-sm h-100">
                                        <div class="card-header-modern">
                                            <h6 class="mb-0"><i class="bi bi-lock me-2"></i>HSTS</h6>
                                        </div>
                                        <div class="card-body">
                                            {% if ssl_data.hsts.enabled %}
                                                <div class="alert alert-success alert-modern mb-2">
                                                    <i class="bi bi-check-circle me-2"></i> Enabled
                                                </div>
                                                <ul class="list-group list-group-flush">
                                                    <li class="list-group-item border-0 px-0">
                                                        Max Age: {{ ssl_data.hsts.max_age }} seconds
                                                    </li>
                                                    {% if ssl_data.hsts.include_subdomains %}
                                                    <li class="list-group-item border-0 px-0">
                                                        Includes Subdomains
                                                    </li>
                                                    {% endif %}
                                                    {% if ssl_data.hsts.preload %}
                                                    <li class="list-group-item border-0 px-0">
                                                        Preload Enabled
                                                    </li>
                                                    {% endif %}
                                                </ul>
                                            {% else %}
                                                <div class="alert alert-danger alert-modern mb-0">
                                                    <i class="bi bi-exclamation-triangle me-2"></i> Not Enabled
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card border-0 shadow-sm h-100">
                                        <div class="card-header-modern">
                                            <h6 class="mb-0"><i class="bi bi-speedometer2 me-2"></i>OCSP Stapling</h6>
                                        </div>
                                        <div class="card-body">
                                            {% if ssl_data.ocsp_stapling.supported %}
                                                <div class="alert alert-success alert-modern mb-2">
                                                    <i class="bi bi-check-circle me-2"></i> Supported
                                                </div>
                                                <ul class="list-group list-group-flush">
                                                    <li class="list-group-item border-0 px-0">
                                                        Status: {{ ssl_data.ocsp_stapling.status|default('unknown', true)|upper }}
                                                    </li>
                                                    {% if ssl_data.ocsp_stapling.valid %}
                                                    <li class="list-group-item border-0 px-0">
                                                        Valid Response
                                                    </li>
                                                    {% endif %}
                                                </ul>
                                            {% else %}
                                                <div class="alert alert-warning alert-modern mb-0">
                                                    <i class="bi bi-exclamation-triangle me-2"></i> Not Supported
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card border-0 shadow-sm h-100">
                                        <div class="card-header-modern">
                                            <h6 class="mb-0"><i class="bi bi-list-check me-2"></i>Certificate Transparency</h6>
                                        </div>
                                        <div class="card-body">
                                            {% if ssl_data.certificate_transparency.logged %}
                                                <div class="alert alert-success alert-modern mb-2">
                                                    <i class="bi bi-check-circle me-2"></i> Logged
                                                </div>
                                                <ul class="list-group list-group-flush">
                                                    <li class="list-group-item border-0 px-0">
                                                        SCTs: {{ ssl_data.certificate_transparency.scts|length }}
                                                    </li>
                                                    {% if ssl_data.certificate_transparency.policy_compliant %}
                                                    <li class="list-group-item border-0 px-0">
                                                        Policy Compliant
                                                    </li>
                                                    {% endif %}
                                                </ul>
                                            {% else %}
                                                <div class="alert alert-warning alert-modern mb-0">
                                                    <i class="bi bi-exclamation-triangle me-2"></i> Not Logged
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Vulnerabilities -->
                            <h5 class="mb-3"><i class="bi bi-bug me-2"></i>Vulnerabilities</h5>
                            <div class="table-responsive mb-4">
                                <table class="table results-table">
                                    <thead>
                                        <tr>
                                            <th>Vulnerability</th>
                                            <th>Status</th>
                                            <th>Risk</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for vuln, present in ssl_data.vulnerabilities.items() %}
                                        <tr>
                                            <td>{{ vuln|replace('_', ' ')|title }}</td>
                                            <td>
                                                {% if present %}
                                                    <span class="badge bg-danger">VULNERABLE</span>
                                                {% else %}
                                                    <span class="badge bg-success">SAFE</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {% if present %}
                                                    {% if vuln in ['heartbleed', 'poodle', 'drown'] %}
                                                        <span class="badge bg-danger">CRITICAL</span>
                                                    {% elif vuln in ['beast', 'freak', 'logjam'] %}
                                                        <span class="badge bg-warning text-dark">HIGH</span>
                                                    {% else %}
                                                        <span class="badge bg-info">MEDIUM</span>
                                                    {% endif %}
                                                {% else %}
                                                    <span class="badge bg-success">NONE</span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-info alert-modern">
            <i class="bi bi-info-circle me-2"></i> No SSL scan data available.
        </div>
    {% endif %}
</div>
                
                <!-- Ports Tab -->
                {% if results.port_scan %}
                <div class="tab-pane fade" id="ports" role="tabpanel">
                    <div class="mb-3">
                        <input type="text" class="form-control form-control-modern" id="portSearch" placeholder="Search ports or services...">
                    </div>
                    <div class="accordion" id="portsAccordion">
                        {% for host in results.port_scan %}
                        <div class="accordion-item border-0 mb-3 shadow-sm">
                            <h2 class="accordion-header" id="heading{{ loop.index }}">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ loop.index }}">
                                    <i class="bi bi-pc-display me-2"></i>
                                    {{ host.target }} 
                                    <span class="badge bg-primary ms-2">{{ host.ports|length }} ports</span>
                                    {% if host.risky_ports|length > 0 %}
                                    <span class="badge bg-danger ms-2">{{ host.risky_ports|length }} risky</span>
                                    {% endif %}
                                </button>
                            </h2>
                            <div id="collapse{{ loop.index }}" class="accordion-collapse collapse" data-bs-parent="#portsAccordion">
                                <div class="accordion-body p-0">
                                    <div class="table-responsive">
                                        <table class="table results-table mb-0">
                                            <thead>
                                                <tr>
                                                    <th>Port</th>
                                                    <th>Service</th>
                                                    <th>Version</th>
                                                    <th>Risk</th>
                                                    <th>Vulnerabilities</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for port in host.ports %}
                                                <tr class="risk-{{ port.risk.level }}">
                                                    <td>{{ port.port }}/{{ port.protocol }}</td>
                                                    <td>{{ port.service }}</td>
                                                    <td>{{ port.version|default('', true) }}</td>
                                                    <td>
                                                        <span class="risk-badge risk-{{ port.risk.level }}">
                                                            {{ port.risk.level|upper }}
                                                        </span>
                                                    </td>
                                                    <td>{{ port.risk.vulnerabilities }}</td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
                
                <!-- DNS Tab -->
                <div class="tab-pane fade" id="dns" role="tabpanel">
                    {% if results.dns_records %}
                    <div class="table-responsive">
                        <table class="table results-table">
                            <thead>
                                <tr>
                                    <th>Record Type</th>
                                    <th>Values</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for record_type, values in results.dns_records.items() %}
                                <tr>
                                    <td><strong>{{ record_type }}</strong></td>
                                    <td>
                                        {% if record_type == 'AXFR' %}
                                            <div class="accordion" id="axfrAccordion">
                                                {% for ns, data in values.items() %}
                                                <div class="accordion-item border-0 mb-2 shadow-sm">
                                                    <h2 class="accordion-header" id="axfrHeading{{ loop.index }}">
                                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                                            data-bs-target="#axfrCollapse{{ loop.index }}" aria-expanded="false">
                                                            {{ ns }}
                                                            <span class="badge ms-2 bg-{% if data.success %}danger{% else %}success{% endif %}">
                                                                {% if data.success %}VULNERABLE{% else %}Secure{% endif %}
                                                            </span>
                                                        </button>
                                                    </h2>
                                                    <div id="axfrCollapse{{ loop.index }}" class="accordion-collapse collapse" 
                                                        aria-labelledby="axfrHeading{{ loop.index }}" data-bs-parent="#axfrAccordion">
                                                        <div class="accordion-body">
                                                            {% if data.success %}
                                                            <div class="alert alert-danger alert-modern">
                                                                <i class="bi bi-exclamation-triangle-fill me-2"></i>
                                                                Zone transfer successful - this is a serious security issue!
                                                            </div>
                                                            <pre class="p-3 bg-light rounded" style="max-height: 300px; overflow-y: auto;">{{ data.records|join('\n') }}</pre>
                                                            {% else %}
                                                            <div class="alert alert-success alert-modern">
                                                                <i class="bi bi-check-circle-fill me-2"></i>
                                                                Zone transfer attempt failed (this is good)
                                                            </div>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                                {% endfor %}
                                            </div>
                                        {% elif record_type == 'CACHE_SNOOPING' %}
                                            <div class="table-responsive">
                                                <table class="table results-table">
                                                    <thead>
                                                        <tr>
                                                            <th>Server</th>
                                                            <th>Likely Cached</th>
                                                            <th>Implication</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for server, cached in values.items() %}
                                                        <tr>
                                                            <td>{{ server }}</td>
                                                            <td>
                                                                <span class="badge bg-{% if cached %}warning{% else %}success{% endif %}">
                                                                    {% if cached %}Yes{% else %}No{% endif %}
                                                                </span>
                                                            </td>
                                                            <td>
                                                                {% if cached %}
                                                                Possible cache snooping vulnerability
                                                                {% else %}
                                                                No cache snooping detected
                                                                {% endif %}
                                                            </td>
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        {% else %}
                                            {% for value in values %}
                                            <div class="mb-2"><code>{{ value }}</code></div>
                                            {% endfor %}
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="alert alert-info alert-modern">
                        <i class="bi bi-info-circle me-2"></i> No DNS records were scanned or found
                    </div>
                    {% endif %}
                </div>
                
<!-- In the Technologies Tab section, replace the current code with: -->
{% if results.tech_detection %}
<div class="tab-pane fade" id="tech" role="tabpanel">
    <div class="row">
        <!-- Technology Overview -->
        <div class="col-md-4">
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header-modern">
                    <h5><i class="bi bi-bar-chart me-2"></i>Technology Overview</h5>
                </div>
                <div class="card-body">
                    <div class="mb-4">
                        <h6>Total Technologies Detected:</h6>
                        <h2 class="text-primary">
                            {% set total_tech = [] %}
                            {% for url, tech_data in results.tech_detection.items() %}
                                {% set _ = total_tech.extend(tech_data.technologies) %}
                            {% endfor %}
                            {{ total_tech|length }}
                        </h2>
                    </div>
                    
                    <div class="mb-4">
                        <h6>Technologies Found:</h6>
                        <div class="d-flex flex-wrap gap-2">
                            {% for url, tech_data in results.tech_detection.items() %}
                                {% for tech in tech_data.technologies %}
                                    <span class="badge bg-{% if tech.category == 'web_servers' %}primary{% elif tech.category == 'frameworks' %}success{% else %}info{% endif %}">
                                        {{ tech.name }}{% if tech.version %} (v{{ tech.version }}){% endif %}
                                    </span>
                                {% endfor %}
                            {% endfor %}
                        </div>
                    </div>
                    
                    {% set cloud_providers = [] %}
                    {% for url, tech_data in results.tech_detection.items() %}
                        {% if tech_data.cloud and tech_data.cloud.provider not in cloud_providers %}
                            {% set _ = cloud_providers.append(tech_data.cloud.provider) %}
                        {% endif %}
                    {% endfor %}
                    {% if cloud_providers %}
                    <div class="mb-4">
                        <h6>Cloud Providers:</h6>
                        <div class="d-flex flex-wrap gap-2">
                            {% for provider in cloud_providers %}
                            <span class="badge bg-info">{{ provider|upper }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    
                    {% set cdns = [] %}
                    {% for url, tech_data in results.tech_detection.items() %}
                        {% if tech_data.cdn and tech_data.cdn.provider not in cdns %}
                            {% set _ = cdns.append(tech_data.cdn.provider) %}
                        {% endif %}
                    {% endfor %}
                    {% if cdns %}
                    <div>
                        <h6>CDN Providers:</h6>
                        <div class="d-flex flex-wrap gap-2">
                            {% for cdn in cdns %}
                            <span class="badge bg-secondary">{{ cdn|title }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            {% set exposed_files = [] %}
            {% for url, tech_data in results.tech_detection.items() %}
                {% if tech_data.exposed_files %}
                    {% for file in tech_data.exposed_files %}
                        {% set _ = exposed_files.append(file) %}
                    {% endfor %}
                {% endif %}
            {% endfor %}
            {% if exposed_files %}
            <div class="card border-0 shadow-sm">
                <div class="card-header-modern">
                    <h5><i class="bi bi-file-earmark-excel me-2"></i>Exposed Files</h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-warning alert-modern mb-3">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                        Found {{ exposed_files|length }} potentially sensitive files
                    </div>
                    <ul class="list-group list-group-flush">
                        {% for file in exposed_files %}
                        <li class="list-group-item border-0 px-0">
                            <a href="{{ file.url }}" target="_blank" class="text-primary">{{ file.url }}</a>
                            <span class="badge bg-secondary float-end">{{ file.content_type }}</span>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Detailed Technology Findings -->
        <div class="col-md-8">
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header-modern d-flex justify-content-between align-items-center">
                    <h5><i class="bi bi-list-check me-2"></i>Technology Details by URL</h5>
                    <input type="text" class="form-control form-control-modern w-50" id="techSearch" placeholder="Search technologies...">
                </div>
                <div class="card-body">
                    <div class="accordion" id="techAccordion">
                        {% for url, tech_data in results.tech_detection.items() %}
                        <div class="accordion-item border-0 mb-3 shadow-sm">
                            <h2 class="accordion-header" id="techHeading{{ loop.index }}">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                    data-bs-target="#techCollapse{{ loop.index }}" aria-expanded="false">
                                    <i class="bi bi-globe me-2"></i>
                                    {{ url }}
                                    <span class="badge bg-primary ms-2">{{ tech_data.technologies|length }} techs</span>
                                    {% if tech_data.secrets %}<span class="badge bg-danger ms-2">{{ tech_data.secrets|length }} secrets</span>{% endif %}
                                </button>
                            </h2>
                            <div id="techCollapse{{ loop.index }}" class="accordion-collapse collapse" 
                                aria-labelledby="techHeading{{ loop.index }}" data-bs-parent="#techAccordion">
                                <div class="accordion-body">
                                    <!-- Cloud/CDN Info -->
                                    {% if tech_data.cloud or tech_data.cdn %}
                                    <div class="row g-3 mb-4">
                                        {% if tech_data.cloud %}
                                        <div class="col-md-6">
                                            <div class="alert alert-info alert-modern">
                                                <h6><i class="bi bi-cloud me-2"></i>Cloud Hosting</h6>
                                                <strong>{{ tech_data.cloud.provider|upper }}</strong> ({{ tech_data.cloud.service }})
                                                <br>
                                                Confidence: {{ tech_data.cloud.confidence }}%
                                            </div>
                                        </div>
                                        {% endif %}
                                        {% if tech_data.cdn %}
                                        <div class="col-md-6">
                                            <div class="alert alert-secondary alert-modern">
                                                <h6><i class="bi bi-speedometer2 me-2"></i>CDN Detected</h6>
                                                <strong>{{ tech_data.cdn.provider|title }}</strong>
                                                <br>
                                                Confidence: {{ tech_data.cdn.confidence }}%
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>
                                    {% endif %}
                                    
                                    <!-- Technologies -->
                                    <h5 class="mb-3">Technologies Detected:</h5>
                                    <div class="d-flex flex-wrap gap-2 mb-4">
                                        {% for tech in tech_data.technologies %}
                                        <span class="badge bg-{% if tech.category == 'web_servers' %}primary{% elif tech.category == 'frameworks' %}success{% else %}info{% endif %}">
                                            {{ tech.name }}{% if tech.version %} (v{{ tech.version }}){% endif %}
                                            {% if tech.confidence < 100 %}<small class="ms-1">{{ tech.confidence }}%</small>{% endif %}
                                        </span>
                                        {% endfor %}
                                    </div>
                                    
                                    <!-- Secrets -->
                                    {% if tech_data.secrets %}
                                    <h5 class="mb-3">Potential Secrets Found:</h5>
                                    <div class="alert alert-danger alert-modern mb-3">
                                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                                        {{ tech_data.secrets|length }} potential secrets found in JavaScript files
                                    </div>
                                    <div class="table-responsive mb-4">
                                        <table class="table results-table">
                                            <thead>
                                                <tr>
                                                    <th>Type</th>
                                                    <th>Found In</th>
                                                    <th>Snippet</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for secret in tech_data.secrets %}
                                                <tr>
                                                    <td>{{ secret.type }}</td>
                                                    <td>{{ secret.file|truncate(30) }}</td>
                                                    <td>
                                                        <div class="p-2 bg-light rounded">
                                                            {{ secret.context|truncate(100) }}
                                                        </div>
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                    {% endif %}
                                    
                                    <!-- Endpoints -->
                                    {% if tech_data.endpoints %}
                                    <h5 class="mb-3">API Endpoints Found:</h5>
                                    <div class="table-responsive">
                                        <table class="table results-table">
                                            <thead>
                                                <tr>
                                                    <th>URL</th>
                                                    <th>Method</th>
                                                    <th>Source</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for endpoint in tech_data.endpoints %}
                                                <tr>
                                                    <td><a href="{{ endpoint.url }}" target="_blank" class="text-primary">{{ endpoint.url|truncate(40) }}</a></td>
                                                    <td>{{ endpoint.method }}</td>
                                                    <td>{{ endpoint.source|truncate(30) }}</td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}
                
                <!-- High-Value Targets Tab -->
                {% if results.security_analysis %}
                <div class="tab-pane fade" id="targets" role="tabpanel">
                    <div class="table-responsive">
                        <table class="table results-table" id="targetsTable">
                            <thead>
                                <tr>
                                    <th>Target</th>
                                    <th>Score</th>
                                    <th>Risk</th>
                                    <th>Reasons</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for target in results.security_analysis.high_value_targets %}
                                <tr>
                                    <td>
                                        <a href="{% if target.https_status %}https://{% else %}http://{% endif %}{{ target.subdomain }}" target="_blank" class="text-primary">
                                            {{ target.subdomain }}
                                        </a>
                                    </td>
                                    <td>{{ target.security_score }}</td>
                                    <td>
                                        <span class="risk-badge risk-{{ target.risk_level|lower }}">
                                            {{ target.risk_level }}
                                        </span>
                                    </td>
                                    <td>{{ target.reasons|join(', ') }}</td>
                                    <td>
                                        {% if target.https_status %}
                                            <span class="badge bg-success">HTTPS: {{ target.https_status }}</span>
                                        {% elif target.http_status %}
                                            <span class="badge bg-warning text-dark">HTTP: {{ target.http_status }}</span>
                                        {% else %}
                                            <span class="badge bg-secondary">No response</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                {% endif %}

                <!-- Users & Emails Tab -->
                <div class="tab-pane fade" id="users" role="tabpanel">
                    {% if results.email_enumeration %}
                        <!-- Email Patterns -->
                        {% if results.email_enumeration.email_formats %}
                        <div class="mb-5">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h4><i class="bi bi-envelope me-2"></i>Email Patterns</h4>
                                <span class="badge bg-primary">{{ results.email_enumeration.email_formats|length }} patterns</span>
                            </div>
                            <div class="table-responsive">
                                <table class="table results-table">
                                    <thead>
                                        <tr>
                                            <th>Pattern</th>
                                            <th>Confidence</th>
                                            <th>Source</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for pattern in results.email_enumeration.email_formats %}
                                        <tr>
                                            <td><code>{{ pattern.pattern }}</code></td>
                                            <td>
                                                <div class="progress progress-modern" style="height: 8px;">
                                                    <div class="progress-bar bg-{% if pattern.confidence > 80 %}success{% elif pattern.confidence > 50 %}warning{% else %}danger{% endif %}" 
                                                         role="progressbar" style="width: {{ pattern.confidence }}%" 
                                                         aria-valuenow="{{ pattern.confidence }}" aria-valuemin="0" aria-valuemax="100">
                                                    </div>
                                                </div>
                                                <small class="text-muted">{{ pattern.confidence }}%</small>
                                            </td>
                                            <td>{{ pattern.source }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        {% endif %}
                        
                        <!-- Found Emails -->
                        {% if results.email_enumeration.found_emails %}
                        <div class="mb-5">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h4><i class="bi bi-mailbox me-2"></i>Discovered Emails</h4>
                                <span class="badge bg-primary">{{ results.email_enumeration.found_emails|length }} emails</span>
                            </div>
                            <div class="alert alert-info alert-modern mb-4">
                                <i class="bi bi-info-circle-fill me-2"></i> Found {{ results.email_enumeration.found_emails|length }} email addresses
                            </div>
                            <div class="table-responsive">
                                <table class="table results-table">
                                    <thead>
                                        <tr>
                                            <th>Email</th>
                                            <th>Type</th>
                                            <th>Confidence</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for email in results.email_enumeration.found_emails %}
                                        <tr>
                                            <td><code>{{ email.email }}</code></td>
                                            <td>
                                                <span class="badge bg-{% if email.type == 'scraped' %}info{% else %}primary{% endif %}">
                                                    {{ email.type }}
                                                </span>
                                            </td>
                                            <td>
                                                <div class="progress progress-modern" style="height: 8px;">
                                                    <div class="progress-bar bg-{% if email.confidence > 80 %}success{% elif email.confidence > 50 %}warning{% else %}danger{% endif %}" 
                                                         role="progressbar" style="width: {{ email.confidence }}%" 
                                                         aria-valuenow="{{ email.confidence }}" aria-valuemin="0" aria-valuemax="100">
                                                    </div>
                                                </div>
                                                <small class="text-muted">{{ email.confidence }}%</small>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        {% endif %}
                        
                        <!-- Login Pages -->
                        {% if results.email_enumeration.login_pages %}
                        <div class="mb-5">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h4><i class="bi bi-door-open me-2"></i>Authentication Pages</h4>
                                <span class="badge bg-{% if results.email_enumeration.login_pages|length > 0 %}danger{% else %}success{% endif %}">
                                    {{ results.email_enumeration.login_pages|length }} found
                                </span>
                            </div>
                            <div class="alert alert-{% if results.email_enumeration.login_pages|length > 0 %}warning{% else %}success{% endif %} alert-modern mb-4">
                                <i class="bi bi-exclamation-triangle-fill me-2"></i> 
                                Found {{ results.email_enumeration.login_pages|length }} authentication pages
                            </div>
                            <div class="table-responsive">
                                <table class="table results-table">
                                    <thead>
                                        <tr>
                                            <th>URL</th>
                                            <th>Type</th>
                                            <th>Source</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for login in results.email_enumeration.login_pages %}
                                        <tr>
                                            <td>
                                                {% if login.url %}
                                                    <a href="{{ login.url }}" target="_blank" class="text-primary">
                                                        {{ login.url|truncate(40) }}
                                                    </a>
                                                {% else %}
                                                    <span class="text-muted">Not available</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {% if login.type %}
                                                    <span class="badge bg-{% if 'office365' in login.type %}primary{% elif 'gsuite' in login.type %}danger{% else %}warning{% endif %}">
                                                        {{ login.type|replace('_', ' ')|title|default('Unknown', true) }}
                                                    </span>
                                                {% else %}
                                                    <span class="badge bg-secondary">Unknown</span>
                                                {% endif %}
                                            </td>
                                            <td>{{ login.source|default('scan', true) }}</td>
                                            <td>
                                                <span class="badge bg-{% if login.status == '200' %}success{% else %}warning{% endif %}">
                                                    {{ login.status|default('200', true) }}
                                                </span>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        {% endif %}
                        
                        <!-- Password Reset Pages -->
                        {% if results.email_enumeration.password_reset_pages %}
                        <div class="mb-4">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h4><i class="bi bi-key me-2"></i>Password Reset Pages</h4>
                                <span class="badge bg-{% if results.email_enumeration.password_reset_pages|length > 0 %}danger{% else %}success{% endif %}">
                                    {{ results.email_enumeration.password_reset_pages|length }} found
                                </span>
                            </div>
                            <div class="alert alert-{% if results.email_enumeration.password_reset_pages|length > 0 %}danger{% else %}success{% endif %} alert-modern mb-4">
                                <i class="bi bi-exclamation-triangle-fill me-2"></i> 
                                Found {{ results.email_enumeration.password_reset_pages|length }} password reset pages
                            </div>
                            <div class="table-responsive">
                                <table class="table results-table">
                                    <thead>
                                        <tr>
                                            <th>URL</th>
                                            <th>Subdomain</th>
                                            <th>Status</th>
                                            <th>Source</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for reset in results.email_enumeration.password_reset_pages %}
                                        <tr>
                                            <td>
                                                {% if reset.url %}
                                                    <a href="{{ reset.url }}" target="_blank" class="text-primary">
                                                        {{ reset.url|truncate(40) }}
                                                    </a>
                                                {% else %}
                                                    <span class="text-muted">Not available</span>
                                                {% endif %}
                                            </td>
                                            <td>{{ reset.subdomain|default(results.domain, true) }}</td>
                                            <td>
                                                <span class="badge bg-{% if reset.status == '200' %}success{% else %}warning{% endif %}">
                                                    {{ reset.status|default('200', true) }}
                                                </span>
                                            </td>
                                            <td>{{ reset.source|default('scan', true) }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        {% endif %}
                    {% else %}
                        <div class="alert alert-info alert-modern">
                            <i class="bi bi-info-circle-fill me-2"></i> No email or authentication page data available
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Initialize DataTables
    $('#subdomainsTable').DataTable({
        pageLength: 10,
        responsive: true,
        dom: '<"top"f>rt<"bottom"lip><"clear">',
        language: {
            search: "_INPUT_",
            searchPlaceholder: "Search subdomains...",
        }
    });
    
    if ($('#targetsTable').length) {
        $('#targetsTable').DataTable({
            pageLength: 10,
            responsive: true,
            order: [[1, 'desc']],
            dom: '<"top"f>rt<"bottom"lip><"clear">',
            language: {
                search: "_INPUT_",
                searchPlaceholder: "Search targets...",
            }
        });
    }

    // Port search functionality
    $('#portSearch').on('keyup', function() {
        const value = $(this).val().toLowerCase();
        $('.accordion-item').each(function() {
            const text = $(this).text().toLowerCase();
            $(this).toggle(text.indexOf(value) > -1);
        });
    });

    // Technology search
    $('#techSearch').on('keyup', function() {
        const value = $(this).val().toLowerCase();
        $('.accordion-item').each(function() {
            const text = $(this).text().toLowerCase();
            $(this).toggle(text.indexOf(value) > -1);
        });
    });

    // Persist tab selection in URL
    $('button[data-bs-toggle="tab"]').on('click', function() {
        const tabId = $(this).attr('data-bs-target');
        window.location.hash = tabId;
    });

    // Check for hash on page load
    if (window.location.hash) {
        const tab = $('[data-bs-target="' + window.location.hash + '"]');
        if (tab.length) {
            tab.tab('show');
        }
    }

    // Show toast when copying proof
    $(document).on('click', '.copy-btn', function() {
        const toast = $(`
            <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
                <div class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="toast-header bg-success text-white">
                        <strong class="me-auto">Copied!</strong>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                    <div class="toast-body">
                        Proof copied to clipboard
                    </div>
                </div>
            </div>
        `);
        $('body').append(toast);
        setTimeout(() => toast.remove(), 2000);
    });
});
</script>
{% endblock %}
